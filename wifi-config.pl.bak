#!/usr/local/bin/perl
#https://thepi.io/how-to-use-your-raspberry-pi-as-a-wireless-access-point/
use strict ;
use warnings ;

my $random = int(rand(1000)) ;
my $command = $ARGV[0] ;

sub file_write
{
  my $filename = shift ;
  my $text = shift ;
  open(my $fh, '>', $filename) or die "Could not open file '$filename' $!";
  print $fh $text ;
  close $fh;
}

my $dhcpcd_add =  qq{
};

my $dhcpcd_default = qq{
};

my $dnsmask_default = qq{
};

my $dnsmask_new = qq{
};

my $hostapd_new = qq{
};

my $sysctl_new = qq{
};

my $sysctl_default = qq{
};

my $network_default = qq{
};

my $network_new = qq{source-directory /etc/network/interfaces.d

auto lo
iface lo inet loopback

iface eth0 inet manual

allow-hotplug wlan0
iface wlan0 inet static
address 192.168.0.12
netmask 255.255.255.0
};

my $iptables = "sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE" ;
my $iptables_flush = "sudo iptables -F" ;

#####
#####
#####
if ($command eq "AP")
{
  #1 Stop servers
  system("systemctl stop hostapd") ;
  system("systemctl stop dnsmasq") ;
  system("service dhcpcd start") ;

  # #2 Configuring a static IP
  # file_write("/etc/dhcpcd.conf", $dhcpcd_default.$dhcpcd_add) ;
  # #3 Configure the DHCP server (dnsmasq)
  # file_write("/etc/dnsmasq.conf", $dnsmask_new) ;
  # # Step 5: Configure the access point host software (hostapd)
  # file_write("/etc/hostapd/hostapd.conf", $hostapd_new) ;
  # # Step 6: Set up traffic forwarding
  # file_write("/etc/sysctl.conf", $sysctl_new) ;
  # # file_write("/etc/network/interfaces", $network_new) ;
  # # Step 7: Add a new iptables rule
  # system($iptables) ;
  #
  # system("service hostapd start") ;
  # system("service dnsmasq start") ;
  # system("service dhcpcd start") ;
  # system("service systemd-sysctl stop ; service systemd-sysctl start") ;

  # system("service networking restart") ;
  # system("reboot") ;
}
elsif ($command eq "CLI")
{
  # #1 Stop servers
  # system("systemctl stop hostapd") ;
  # system("systemctl stop dnsmasq") ;
  #
  #
  #
  # # Step 7: Add a new iptables rule
  # system($iptables_flush) ;
}
else
{
  exit ;
}
