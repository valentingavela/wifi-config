#!/usr/local/bin/perl
use File::Slurp;

while (true) {
  sleep(1);

  my $status = system('echo -e "GET http://google.com HTTP/1.0\n\n" | nc google.com 80 > /dev/null 2>&1') ;
  my $actual_mode = read_file( '/tmp/actual_mode' ) ;

  print($status);
  print($actual_mde);

  if($status == 1 && $actual_mode ne 'AP') #TODO check if ap actually configured
  {
      print("AP MODE") ;
      system("perl /home/pi/wifi-config/wifi-config.pl AP") ;
      system("echo AP > /tmp/actual_wifi_mode") ;
  }
  elsif($status == 1 && $actual_mode ne 'CLI')
  {
      my $conf = read_file( '/tmp/configure_wifi' ) ;
      if ($conf == 1) #TODO check if already in client mode
      {
          print("CLI MODE") ;
          system("perl /home/pi/wifi-config/wifi-config.pl CLI") ;
          system("echo CLI > /tmp/actual_wifi_mode") ;
      }
  }
  else
  {
    print("do nothing") ;
  }
}
